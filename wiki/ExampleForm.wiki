#summary A simple winform example
#labels Phase-Implementation,Featured

= Introduction =

Imagine we have all the controls on a form.

{{{

GEToolStrip geToolStrip1;
GEWebBrowser geWebBrowser1;
KmlTreeView kmlTreeView1;
GEStatusStrip geStatusStrip1;

}}}

= Details =

{{{
 public partial class Form1 : Form
    {
        private dynamic ge;

        public Form1()
        {
            InitializeComponent();
              
            // load the test page
            geWebBrowser1.LoadEmbededPlugin();

            // set up some event handelers
            geWebBrowser1.PluginReady += new GEWebBrowserEventHandeler(geWebBrowser1_PluginReady);
            geWebBrowser1.KmlLoaded += new GEWebBrowserEventHandeler(geWebBrowser1_KmlLoaded);
            geWebBrowser1.KmlEvent += new GEWebBrowserEventHandeler(geWebBrowser1_KmlEvent);
            geWebBrowser1.ViewEvent += new GEWebBrowserEventHandeler(geWebBrowser1_ViewEvent);
            geWebBrowser1.ScriptError += new GEWebBrowserEventHandeler(geWebBrowser1_ScriptError);
        }

        void geWebBrowser1_KmlLoaded(object sender, GEEventArgs e)
        {
            dynamic kml = sender;

            if (null != kml)
            {
                // add the kml to the tree view and plug-in
                ge.getFeatures().appendChild(kml);
                kmlTreeView1.ParsekmlObject(kml);
            }
        }
   
        void geWebBrowser1_KmlEvent(object sender, GEEventArgs e)
        {
            dynamic mouseEvent = sender;

            if (null != mouseEvent)
            {
                MessageBox.Show(mouseEvent.getTarget());
            }
        }

        void geWebBrowser1_ViewEvent(object sender, GEEventArgs e)
        {
            MessageBox.Show(e.message);
            // the message should fire once as we now remove the event
            geWebBrowser1.RemoveEventListener(ge.getView(), "viewchangeend");
        }

        void geWebBrowser1_PluginReady(object sender, GEEventArgs e)
        {
            GEWebBrowser browser = sender as GEWebBrowser;

            if(null != browser)
            {
              // set a reference to the plug-in object
              ge = browser.GetPlugin();
 
              // register the controls with the plug-in
              kmlTreeView1.SetBrowserInstance(browser);
              geToolStrip1.SetBrowserInstance(browser);
              geStatusStrip1.SetBrowserInstance(browser);

              // add some events
              browser.AddEventListener(ge.getGlobe(), "click");
              browser.AddEventListener(ge.getView(), "viewchangeend");
            }
        }

        void geWebBrowser1_ScriptError(object sender, GEEventArgs e)
        {
            MessageBox.Show(e.message, e.data);
        }
    }

}}}

<wiki:gadget url="http://earthapi.googlepages.com/ad.xml" border="0" width="728" height="90" />